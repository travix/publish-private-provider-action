# Publish Private Terraform Provider Action [![Continues Integration](https://github.com/travix/publish-private-provider-action/actions/workflows/on-push.yaml/badge.svg)](https://github.com/travix/publish-private-provider-action/actions/workflows/on-push.yaml)

Publishes a private terraform provider generated by goreleaser to the Terraform Cloud


## Usage

### Pre-requisites

Goreleaser should be run before this action to generate the provider binaries and artifacts.
Check [terraform-provider-scaffolding-framework] for example of how to use goreleaser to generate the provider binaries and artifacts.

### Inputs

* `access-token`: `REQUIRED` Terraform Cloud access token.
* `version`: Version of the provider to be published. Default to tag name if run on tag event, else throws an error
* `dist-path`: Path to the dist folder generated by goreleaser
* `gpg-key-id`: GPG key-id from terraform cloud to generate the new version. Default to first key-id found in [list-gpg-keys] API
* `namespace`: Namespace of the provider. Default to GitHub org name
* `provider-name`: Name of the provider. Default to repo name without 'terraform-provider-' prefix

### Example workflow

```yaml
name: Publish

on: push

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: Setup repository
      uses: actions/setup-go@v4
    - name: Import GPG key
      uses: crazy-max/ghaction-import-gpg@v5
      id: import_gpg
      with:
        gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }} // for signing the artifacts
        passphrase: ${{ secrets.GPG_PASSPHRASE }} // for signing the artifacts
    - name: Run GoReleaser
      uses: goreleaser/goreleaser-action@v4
      with:
        args: release --clean
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GPG_FINGERPRINT: ${{ steps.import_gpg.outputs.fingerprint }}

    ## Actual use of this action
    - name: Publish to terraform cloud
      uses: travix/publish-private-provider-action@v0
      with:
        access-token: ${{ secrets.TF_CLOUD_ACCESS_TOKEN }} // for publishing the provider to terraform cloud
        gp-key-id: some-key-id-123 // this is key-id from terraform cloud for same gpg key used for signing the artifacts
```

## License

The scripts and documentation in this project are released under the [MIT License](LICENSE)

[terraform-provider-scaffolding-framework]: https://github.com/hashicorp/terraform-provider-scaffolding-framework/tree/main
[list-gpg-keys]: https://developer.hashicorp.com/terraform/cloud-docs/api-docs/private-registry/gpg-keys#list-gpg-keys
